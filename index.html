<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Main Timeline</title>
  <link rel="stylesheet" href="css/estilo.css">
</head>
<body>

<h1>jocarsa | slategrey</h1>

<div id="container">

  <!-- TOP BAR with open-window buttons + timeline info -->
  <div id="topPanelSingleRow">
    <button id="btnOpenMonitor">Open Monitor</button>
    <button id="btnOpenParams">Open Parameters</button>

    <div style="margin-left: 20px;">
      <strong>Current Time:</strong>
      <span id="timeDisplay">0.00</span> s
    </div>
  </div>

  <!-- BOTTOM PANEL: Timeline UI (same as before) -->
  <div id="bottomPanel">
    <!-- Time scale (ruler) -->
    <div id="timeScale"></div>

    <div id="tracksContainer">
      <!-- The main time cursor (red line) -->
      <div id="timeCursor" class="time-cursor"></div>
      <!-- A ghost cursor (unused here, but kept for consistency) -->
      <div id="ghostCursor" class="time-cursor ghost-cursor" style="display:none;"></div>

      <!-- VIDEO TRACK #1 -->
      <div class="trackRow">
        <div class="trackLabel">V1</div>
        <div id="trackVideo1" class="track"
             ondragover="event.preventDefault();"
             ondrop="handleFileDrop(event, 'video1')">
        </div>
      </div>

      <!-- VIDEO TRACK #2 -->
      <div class="trackRow">
        <div class="trackLabel">V2</div>
        <div id="trackVideo2" class="track"
             ondragover="event.preventDefault();"
             ondrop="handleFileDrop(event, 'video2')">
        </div>
      </div>

      <!-- AUDIO TRACK -->
      <div class="trackRow">
        <div class="trackLabel">A</div>
        <div id="trackAudio" class="track"
             ondragover="event.preventDefault();"
             ondrop="handleFileDrop(event, 'audio')">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- We rely on the same JS partials for timeline logic. -->
<script src="js/codigo.php"></script>

<script>
  // En este setup de múltiples ventanas, la fuente de verdad es el timeline.
  let monitorWin = null;
  let paramsWin  = null;

  // Se abren las ventanas hijas sin retardo fijo; cada una solicitará el estado inicial.
  document.getElementById('btnOpenMonitor').addEventListener('click', () => {
    if (!monitorWin || monitorWin.closed) {
      monitorWin = window.open('monitor.html', 'monitorWin', 'width=800,height=600');
    } else {
      monitorWin.focus();
    }
  });

  document.getElementById('btnOpenParams').addEventListener('click', () => {
    if (!paramsWin || paramsWin.closed) {
      paramsWin = window.open('parameters.html', 'paramsWin', 'width=400,height=600');
    } else {
      paramsWin.focus();
    }
  });

  /** Actualiza la visualización del “current time” en la ventana principal. */
  function updateTimeDisplay() {
    document.getElementById('timeDisplay').textContent = currentPreviewTime.toFixed(2);
  }
</script>

</body>
</html>

